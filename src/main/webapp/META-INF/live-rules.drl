###############################################################################
package org.jahia.modules.visibility.rules

#list any import classes here.
import org.jahia.services.content.rules.*
import org.jahia.modules.visibility.rules.*
import org.slf4j.Logger

expander rules.dsl

#declare any global variables here
global User user
global Service service
global Logger logger
global VisibilityRuleService visibilityService 
###############################################################################

rule "Flush caches for start date visibility condition"
    salience 25
    when
        A property start has been set on a node
             - the node has the type jnt:startEndDateCondition
    then
        Execute the action "startDateVisibilityAction" now on the node
        Execute the action "startDateVisibilityAction" at start on the node
end

rule "Flush caches for end date visibility condition"
    salience 25
    when
        A property end has been set on a node
             - the node has the type jnt:startEndDateCondition
    then
        Execute the action "endDateVisibilityAction" now on the node
        Execute the action "endDateVisibilityAction" at end on the node
end

rule "Flush caches when j:conditionalVisibility is suppressed"
    salience 25
    when
        A node is deleted
             - its name is j:conditionalVisibility
    then
        Execute the action "flushVisibilityOnDeleteAll" now on the parent
end

rule "Flush caches when a jnt:condition is suppressed"
    salience 25
    when
        A node is deleted
        The node has a parent
            - the parent has the type jnt:conditionalVisibility
    then
        Execute the action "flushVisibilityOnDelete" now on the parent
end